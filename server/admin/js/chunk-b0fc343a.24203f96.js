(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-b0fc343a"],{"02f9":function(e,t,a){"use strict";var i=a("b8a8"),s=a.n(i);s.a},"6ba5":function(e,t,a){"use strict";var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-date-picker",{attrs:{type:"datetime",placeholder:"选择日期时间","value-format":"timestamp"},model:{value:e.value,callback:function(t){e.value=t},expression:"value"}})},s=[],l={name:"Date",props:["originalDate"],data(){return{value:""}},watch:{value(e){this.$emit("getDate",e)},originalDate(e){this.value=this.originalDate}}},o=l,n=a("2877"),d=Object(n["a"])(o,i,s,!1,null,null,null);t["a"]=d.exports},8128:function(e,t,a){"use strict";var i=a("ecc1"),s=a.n(i);s.a},b8a8:function(e,t,a){},ecc1:function(e,t,a){},f7ff:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:e.fullscreenLoading,expression:"fullscreenLoading",modifiers:{fullscreen:!0,lock:!0}}],staticClass:"article-new"},[a("section",[a("h2",{staticClass:"tit"},[e._v("无人问津的心情，在黑纸白字间游荡！")]),a("el-input",{ref:"refTitleInput",attrs:{placeholder:"标题",clearable:""},model:{value:e.data.title,callback:function(t){e.$set(e.data,"title",t)},expression:"data.title"}})],1),a("mavon-editor",{ref:"markdown",attrs:{subfield:!1},on:{imgAdd:e.editorImage,imgDel:e.$imgDel},model:{value:e.data.content,callback:function(t){e.$set(e.data,"content",t)},expression:"data.content"}}),a("section",[a("Date",{attrs:{originalDate:e.data.time},on:{getDate:e.getDate}}),a("el-input",{attrs:{placeholder:"文章摘要","prefix-icon":"el-icon-document",clearable:""},model:{value:e.data.describe,callback:function(t){e.$set(e.data,"describe",t)},expression:"data.describe"}}),a("Upload",{attrs:{music:e.data.music,image:e.data.image,uploadType:e.uploadType},on:{changeMediaType:e.changeMediaType,uploadComponentChange:e.uploadComponentChange}}),a("el-switch",{attrs:{"inactive-text":"发布文章","active-text":"隐藏文章"},model:{value:e.data.hide,callback:function(t){e.$set(e.data,"hide",t)},expression:"data.hide"}})],1),a("el-button",{staticClass:"submit",attrs:{type:"primary"},on:{click:e.submit}},[e._v("SUBMIT")])],1)},s=[],l=a("6ba5"),o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[e.isUploadType?a("div",{staticClass:"upload-box"},e._l(["music","image"],(function(t,i){return a("el-upload",{key:i,ref:"upload",refInFor:!0,staticClass:"upload-item",attrs:{"show-file-list":!1,"http-request":e.uploadChange,name:t,action:"",drag:""}},["music"==t?[a("i",{staticClass:"el-icon-headset"}),a("div",{staticClass:"el-upload__text"},[e._v(e._s(e.music.name||"背景音乐"))])]:[e.image.url?a("img",{attrs:{src:e.image.url}}):[a("i",{staticClass:"el-icon-picture-outline-round"}),a("div",{staticClass:"el-upload__text"},[e._v(" 封面图片 (680*440) ")])]]],2)})),1):[a("el-input",{attrs:{placeholder:"音乐地址","prefix-icon":"el-icon-headset",clearable:""},model:{value:e.music.url,callback:function(t){e.$set(e.music,"url",t)},expression:"music.url"}}),a("el-input",{attrs:{placeholder:"封面图片","prefix-icon":"el-icon-picture-outline-round",clearable:""},model:{value:e.image.url,callback:function(t){e.$set(e.image,"url",t)},expression:"image.url"}})],a("el-switch",{attrs:{"active-text":"文件上传","inactive-text":"输入链接"},model:{value:e.isUploadType,callback:function(t){e.isUploadType=t},expression:"isUploadType"}})],2)},n=[],d={name:"Upload",props:{music:{type:Object,default:()=>{}},image:{type:Object,default:()=>{}},uploadType:{type:String,default:""}},data(){return{isUploadType:!0}},watch:{isUploadType(e){this.$emit("changeMediaType",e)}},methods:{uploadChange(e){const t=["audio","image"],a="music"==e.filename?"audio":e.filename,i=t.indexOf(e.file.type.split("/")[0]);if(a!=t[i])return void this.$message.error(`请选择${a}格式的文件!`);const s=e.filename,l=e.file,o=this.$formData({file:l,type:this.uploadType});this.$emit("uploadComponentChange",{type:s,data:{url:URL.createObjectURL(l),name:l.name,form:o}})}}},r=d,c=(a("8128"),a("2877")),u=Object(c["a"])(r,o,n,!1,null,"3b99a37d",null),m=u.exports,p=a("b2d8"),h=(a("64e1"),{components:{Date:l["a"],mavonEditor:p["mavonEditor"],Upload:m},data(){return{id:"",data:{title:"",content:"",contentHtml:"",describe:"",time:"",image:{},music:{},hide:!1},markdownImage:[],isUpload:!1,fullscreenLoading:!1,mediaType:"upload"}},created(){this.id=this.$route.query.id,this.id&&this.loadData(this.id)},mounted(){this.$refs.refTitleInput.focus()},computed:{uploadType(){return this.$store.state.$data.info.base.uploadType},musicName(){return this.data["music"].url?this.data["music"].name||this.data["music"].url:"背景音乐"}},methods:{loadData(e){this.$request(()=>this.$http.get(`article/${e}`).then(e=>{1===e.data.status?this.data=e.data.body:this.$message.error(e.data.body.message)}))},uploadComponentChange({type:e,data:t}){this.$set(this.data,e,t)},changeMediaType(e){this.mediaType=e?"upload":"text"},editorImage(e,t){const a=this.$formData({file:t,type:this.uploadType});this.markdownImage.push({index:e,form:a})},$imgDel(e){this.markdownImage.splice(e,1)},async submit(){const e=this.$refs.markdown;this.data.content=e.d_value;const t={title:"请输入标题",content:"请输入内容",time:"请选择时间"};for(let n in t)if(!this.data[n])return void this.$message.error(`${t[n]}`);this.fullscreenLoading=!0;const a={contentHtml:e.d_render,content:e.d_value,words:e.d_value.length};for(let n in a)this.data[n]=a[n];const i=this.data.describe;this.data.describe=i||this.data.content.slice(0,60)+"...";const s=this.id?`article/${this.data._id}`:"article",l=this.id?"更新":"发表",o=await this.uploadFile();console.log("fileRes",o),this.$http.post(s,{data:this.data}).then(e=>{1===e.data.status?(this.$message.success(`${l}成功`),this.$router.push("/article"),this.$infoUpdate()):this.$message.error(`${l}失败，请检查网络问题!`),this.fullscreenLoading=!1})},getDate(e){this.data.time=e},uploadFile(){return new Promise(async(e,t)=>{const a=this.markdownImage;for(let i=0;i<a.length;i++){const e=await this.$http.post("/upload",a[i]["form"]),t=e.data.body;if(1!=e.data.status){this.fullscreenLoading=!1,this.$message.error(t.message);break}markdown.$img2Url(i+1,t.url)}if("upload"==this.mediaType)for(let i of["image","music"]){const e=this.data[i];if(e.form){const a=await this.$http.post("/upload",e.form);if(1!=a.data.status)return this.$message.error(a.data.body.message),this.fullscreenLoading=!1,void t(a.data.body.message);e.url=a.data.body.url,delete e.form}}e("File upload completed")})}}}),f=h,g=(a("02f9"),Object(c["a"])(f,i,s,!1,null,"781a05ea",null));t["default"]=g.exports}}]);
//# sourceMappingURL=chunk-b0fc343a.24203f96.js.map